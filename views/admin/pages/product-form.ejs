<!-- File: /views/admin/pages/product-form.ejs (Đã sửa lỗi) -->

<%- include('../partials/header') %>
<%- include('../partials/sidebar') %>

<!-- Tiêu đề sẽ thay đổi tùy thuộc vào việc thêm hay sửa -->
<h1><%= title %></h1>

<div class="card">
    <div class="card-body">
        <!-- Form này sẽ được xử lý bằng JS phía client -->
        <form id="productForm">
            <div class="row">
                <div class="col-md-8">
                    <div class="mb-3">
                        <label for="ten_sach" class="form-label">Tên sách</label>
                        <!-- Nếu có `product`, điền `ten_sach` vào value, nếu không thì để trống -->
                        <input type="text" class="form-control" id="ten_sach" name="ten_sach" value="<%= product ? product.ten_sach : '' %>" required>
                    </div>

                    <div class="mb-3">
                        <label for="mo_ta_ngan" class="form-label">Mô tả</label>
                        <textarea class="form-control" id="mo_ta_ngan" name="mo_ta_ngan" rows="5"><%= product ? product.mo_ta_ngan : '' %></textarea>
                    </div>
                </div>

                <div class="col-md-4">
                     <div class="mb-3">
                        <label for="gia_bia" class="form-label">Giá bìa</label>
                        <input type="number" class="form-control" id="gia_bia" name="gia_bia" value="<%= product ? parseFloat(product.gia_bia) : '' %>" required>
                    </div>

                    <div class="mb-3">
                        <label for="so_luong_ton_kho" class="form-label">Số lượng tồn kho</label>
                        <input type="number" class="form-control" id="so_luong_ton_kho" name="so_luong_ton_kho" value="<%= product ? product.so_luong_ton_kho : '0' %>">
                    </div>

                    <div class="mb-3">
                        <label for="danh_muc_id" class="form-label">Danh mục</label>
                        <select class="form-select" id="danh_muc_id" name="danh_muc_id" required>
                            <option value="">-- Chọn danh mục --</option>
                            <% categories.forEach(category => { %>
                                <!-- Nếu là trang sửa và ID danh mục khớp, chọn `selected` -->
                                <option value="<%= category.id %>" <%= (product && product.danh_muc_id == category.id) ? 'selected' : '' %>>
                                    <%= category.ten_danh_muc %>
                                </option>
                            <% }) %>
                        </select>
                    </div>
                    
                     <div class="mb-3">
                        <label for="tac_gia" class="form-label">Tác giả</label>
                        <input type="text" class="form-control" id="tac_gia" name="tac_gia" value="<%= product ? product.tac_gia : '' %>">
                    </div>
                    
                    <div class="mb-3">
                        <label for="img" class="form-label">Link ảnh đại diện</label>
                        <input type="text" class="form-control" id="img" name="img" value="<%= product ? product.img : '' %>">
                        <% if (product && product.img) { %>
                            <img src="<%= product.img %>" alt="preview" class="img-thumbnail mt-2" width="100">
                        <% } %>
                    </div>
                </div>
            </div>

            <hr>
            <!-- Nút submit -->
            <button type="submit" class="btn btn-primary"><%= product ? 'Lưu thay đổi' : 'Thêm sản phẩm' %></button>
            <a href="/admin/products" class="btn btn-secondary">Hủy</a>
        </form>
    </div>
</div>

<!-- ĐÃ SỬA LẠI ĐÚNG ĐƯỜNG DẪN -->
<script src="/js/admin-product.js"></script>

<%- include('../partials/footer') %>